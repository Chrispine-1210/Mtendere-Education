<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mtendere Education Consult - Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .sidebar .nav-link {
            color: rgba(255,255,255,0.8);
            transition: all 0.3s;
        }
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            color: white;
            background-color: rgba(255,255,255,0.1);
            border-radius: 8px;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .card {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            border: 1px solid rgba(0,0,0,.125);
        }
        .btn-outline-primary:hover {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .form-label {
            font-weight: 600;
            color: #495057;
        }
        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        .badge {
            font-size: 0.75em;
        }
        .alert {
            border: none;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/admin">
                <i class="fas fa-graduation-cap me-2"></i>
                Mtendere Education Admin
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/analytics" target="_blank">
                    <i class="fas fa-chart-line me-1"></i>Analytics
                </a>
                <a class="nav-link" href="/docs" target="_blank">
                    <i class="fas fa-code me-1"></i>API Docs
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 p-0">
                <div class="sidebar p-3">
                    <nav class="nav flex-column">
                        <a href="#" class="nav-link active mb-2" data-section="dashboard">
                            <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                        </a>
                        <a href="#" class="nav-link mb-2" data-section="blog">
                            <i class="fas fa-newspaper me-2"></i>Blog Posts
                        </a>
                        <a href="#" class="nav-link mb-2" data-section="testimonials">
                            <i class="fas fa-star me-2"></i>Testimonials
                        </a>
                        <a href="#" class="nav-link mb-2" data-section="team">
                            <i class="fas fa-users me-2"></i>Team Members
                        </a>
                        <a href="#" class="nav-link mb-2" data-section="scholarships">
                            <i class="fas fa-graduation-cap me-2"></i>Scholarships
                        </a>
                        <a href="#" class="nav-link mb-2" data-section="applications">
                            <i class="fas fa-file-text me-2"></i>Applications
                        </a>
                        <a href="#" class="nav-link mb-2" data-section="users">
                            <i class="fas fa-user-cog me-2"></i>Users
                        </a>
                    </nav>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10">
                <!-- Dashboard Section -->
                <div id="dashboard" class="content-section active p-4">
                    <h2 class="mb-4">Dashboard Overview</h2>
                    <div class="row mb-4">
                        <div class="col-md-3 mb-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <i class="fas fa-newspaper fa-2x text-primary mb-2"></i>
                                    <h5 class="card-title" id="total-posts">0</h5>
                                    <p class="card-text text-muted">Blog Posts</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <i class="fas fa-star fa-2x text-warning mb-2"></i>
                                    <h5 class="card-title" id="total-testimonials">0</h5>
                                    <p class="card-text text-muted">Testimonials</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <i class="fas fa-users fa-2x text-success mb-2"></i>
                                    <h5 class="card-title" id="total-team">0</h5>
                                    <p class="card-text text-muted">Team Members</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <i class="fas fa-graduation-cap fa-2x text-info mb-2"></i>
                                    <h5 class="card-title" id="total-scholarships">0</h5>
                                    <p class="card-text text-muted">Scholarships</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Quick Actions</h5>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-primary" onclick="showSection('blog')">
                                            <i class="fas fa-plus me-2"></i>Create Blog Post
                                        </button>
                                        <button class="btn btn-success" onclick="showSection('testimonials')">
                                            <i class="fas fa-star me-2"></i>Add Testimonial
                                        </button>
                                        <button class="btn btn-info" onclick="showSection('team')">
                                            <i class="fas fa-user-plus me-2"></i>Add Team Member
                                        </button>
                                        <button class="btn btn-warning" onclick="showSection('scholarships')">
                                            <i class="fas fa-graduation-cap me-2"></i>Add Scholarship
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">System Status</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="text-center">
                                                <i class="fas fa-database fa-2x text-success mb-2"></i>
                                                <p class="mb-0 small">Database</p>
                                                <span class="badge bg-success">Connected</span>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="text-center">
                                                <i class="fas fa-server fa-2x text-primary mb-2"></i>
                                                <p class="mb-0 small">API Server</p>
                                                <span class="badge bg-primary">Online</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Blog Posts Section -->
                <div id="blog" class="content-section p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Blog Posts</h2>
                        <button class="btn btn-primary" onclick="openBlogModal()">
                            <i class="fas fa-plus me-2"></i>New Post
                        </button>
                    </div>
                    
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Title</th>
                                            <th>Status</th>
                                            <th>Created</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="blogTableBody">
                                        <!-- Data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Testimonials Section -->
                <div id="testimonials" class="content-section p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Testimonials</h2>
                        <button class="btn btn-success" onclick="openTestimonialModal()">
                            <i class="fas fa-plus me-2"></i>Add Testimonial
                        </button>
                    </div>
                    
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Role</th>
                                            <th>Rating</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="testimonialsTableBody">
                                        <!-- Data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Team Members Section -->
                <div id="team" class="content-section p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Team Members</h2>
                        <button class="btn btn-info" onclick="openTeamModal()">
                            <i class="fas fa-plus me-2"></i>Add Member
                        </button>
                    </div>
                    
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Position</th>
                                            <th>Email</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="teamTableBody">
                                        <!-- Data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Scholarships Section -->
                <div id="scholarships" class="content-section p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Scholarships</h2>
                        <button class="btn btn-warning" onclick="openScholarshipModal()">
                            <i class="fas fa-plus me-2"></i>Add Scholarship
                        </button>
                    </div>
                    
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Title</th>
                                            <th>Amount</th>
                                            <th>Country</th>
                                            <th>Deadline</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="scholarshipsTableBody">
                                        <!-- Data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Applications Section -->
                <div id="applications" class="content-section p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Applications</h2>
                        <button class="btn btn-outline-primary" onclick="loadApplications()">
                            <i class="fas fa-sync me-2"></i>Refresh
                        </button>
                    </div>
                    
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Status</th>
                                            <th>Date</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="applicationsTableBody">
                                        <!-- Data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Users Section -->
                <div id="users" class="content-section p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Users</h2>
                        <button class="btn btn-outline-primary" onclick="loadUsers()">
                            <i class="fas fa-sync me-2"></i>Refresh
                        </button>
                    </div>
                    
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Email</th>
                                            <th>Name</th>
                                            <th>Role</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="usersTableBody">
                                        <!-- Data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Blog Post Modal -->
    <div class="modal fade" id="blogModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="blogModalTitle">Create Blog Post</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form id="blogForm" onsubmit="saveBlogPost(event)">
                    <div class="modal-body">
                        <input type="hidden" id="blogId">
                        <div class="mb-3">
                            <label for="blogTitle" class="form-label">Title *</label>
                            <input type="text" class="form-control" id="blogTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="blogExcerpt" class="form-label">Excerpt</label>
                            <textarea class="form-control" id="blogExcerpt" rows="2" placeholder="Brief description of the blog post"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="blogContent" class="form-label">Content *</label>
                            <textarea class="form-control" id="blogContent" rows="8" required placeholder="Write your blog post content here..."></textarea>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="blogPublished">
                            <label class="form-check-label" for="blogPublished">
                                Publish immediately
                            </label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Post</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Testimonial Modal -->
    <div class="modal fade" id="testimonialModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="testimonialModalTitle">Add Testimonial</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form id="testimonialForm" onsubmit="saveTestimonial(event)">
                    <div class="modal-body">
                        <input type="hidden" id="testimonialId">
                        <div class="mb-3">
                            <label for="testimonialName" class="form-label">Name *</label>
                            <input type="text" class="form-control" id="testimonialName" required>
                        </div>
                        <div class="mb-3">
                            <label for="testimonialRole" class="form-label">Role *</label>
                            <input type="text" class="form-control" id="testimonialRole" required placeholder="e.g., Student, Graduate">
                        </div>
                        <div class="mb-3">
                            <label for="testimonialCompany" class="form-label">Company/Institution</label>
                            <input type="text" class="form-control" id="testimonialCompany" placeholder="e.g., University Name">
                        </div>
                        <div class="mb-3">
                            <label for="testimonialContent" class="form-label">Testimonial Content *</label>
                            <textarea class="form-control" id="testimonialContent" rows="4" required placeholder="Share their experience..."></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="testimonialRating" class="form-label">Rating *</label>
                            <select class="form-select" id="testimonialRating" required>
                                <option value="">Select Rating</option>
                                <option value="5">5 Stars - Excellent</option>
                                <option value="4">4 Stars - Very Good</option>
                                <option value="3">3 Stars - Good</option>
                                <option value="2">2 Stars - Fair</option>
                                <option value="1">1 Star - Poor</option>
                            </select>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="testimonialActive" checked>
                            <label class="form-check-label" for="testimonialActive">
                                Active (show on website)
                            </label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success">Save Testimonial</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Team Member Modal -->
    <div class="modal fade" id="teamModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="teamModalTitle">Add Team Member</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form id="teamForm" onsubmit="saveTeamMember(event)">
                    <div class="modal-body">
                        <input type="hidden" id="teamId">
                        <div class="mb-3">
                            <label for="teamName" class="form-label">Name *</label>
                            <input type="text" class="form-control" id="teamName" required>
                        </div>
                        <div class="mb-3">
                            <label for="teamPosition" class="form-label">Position *</label>
                            <input type="text" class="form-control" id="teamPosition" required placeholder="e.g., Education Consultant, Director">
                        </div>
                        <div class="mb-3">
                            <label for="teamBio" class="form-label">Bio</label>
                            <textarea class="form-control" id="teamBio" rows="3" placeholder="Brief professional background..."></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="teamEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="teamEmail" placeholder="professional@email.com">
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="teamActive" checked>
                            <label class="form-check-label" for="teamActive">
                                Active (show on website)
                            </label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-info">Save Team Member</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scholarship Modal -->
    <div class="modal fade" id="scholarshipModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="scholarshipModalTitle">Add Scholarship</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form id="scholarshipForm" onsubmit="saveScholarship(event)">
                    <div class="modal-body">
                        <input type="hidden" id="scholarshipId">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="scholarshipTitle" class="form-label">Title *</label>
                                    <input type="text" class="form-control" id="scholarshipTitle" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="scholarshipAmount" class="form-label">Amount ($)</label>
                                    <input type="number" class="form-control" id="scholarshipAmount" min="0" step="0.01">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="scholarshipDescription" class="form-label">Description *</label>
                            <textarea class="form-control" id="scholarshipDescription" rows="4" required placeholder="Describe the scholarship opportunity..."></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="scholarshipEligibility" class="form-label">Eligibility Criteria</label>
                            <textarea class="form-control" id="scholarshipEligibility" rows="3" placeholder="Who can apply for this scholarship..."></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="scholarshipCountry" class="form-label">Country</label>
                                    <input type="text" class="form-control" id="scholarshipCountry" placeholder="e.g., Canada, USA, UK">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="scholarshipField" class="form-label">Field of Study</label>
                                    <input type="text" class="form-control" id="scholarshipField" placeholder="e.g., Engineering, Medicine">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="scholarshipDeadline" class="form-label">Application Deadline</label>
                            <input type="date" class="form-control" id="scholarshipDeadline">
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="scholarshipActive" checked>
                            <label class="form-check-label" for="scholarshipActive">
                                Active (show on website)
                            </label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-warning">Save Scholarship</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Success/Error Alerts -->
    <div id="alertContainer" class="position-fixed top-0 end-0 p-3" style="z-index: 1060;"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let currentEditId = null;
        let currentEditType = null;

        // Navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionName).classList.add('active');
            
            // Add active class to nav link
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');
            
            // Load data for the section
            loadSectionData(sectionName);
        }

        // Load section data
        function loadSectionData(section) {
            switch(section) {
                case 'dashboard':
                    loadDashboardStats();
                    break;
                case 'blog':
                    loadBlogPosts();
                    break;
                case 'testimonials':
                    loadTestimonials();
                    break;
                case 'team':
                    loadTeamMembers();
                    break;
                case 'scholarships':
                    loadScholarships();
                    break;
                case 'applications':
                    loadApplications();
                    break;
                case 'users':
                    loadUsers();
                    break;
            }
        }

        // Dashboard stats
        async function loadDashboardStats() {
            try {
                const [posts, testimonials, team, scholarships] = await Promise.all([
                    fetch('/api/blog-posts').then(r => r.json()),
                    fetch('/api/testimonials').then(r => r.json()),
                    fetch('/api/team-members').then(r => r.json()),
                    fetch('/api/scholarships').then(r => r.json())
                ]);
                
                document.getElementById('total-posts').textContent = posts.length;
                document.getElementById('total-testimonials').textContent = testimonials.length;
                document.getElementById('total-team').textContent = team.length;
                document.getElementById('total-scholarships').textContent = scholarships.length;
            } catch (error) {
                console.error('Error loading dashboard stats:', error);
                showAlert('Error loading dashboard statistics', 'error');
            }
        }

        // Blog Posts
        async function loadBlogPosts() {
            try {
                const posts = await fetch('/api/blog-posts').then(r => r.json());
                const tbody = document.getElementById('blogTableBody');
                
                tbody.innerHTML = posts.map(post => `
                    <tr>
                        <td>${post.id}</td>
                        <td>${post.title}</td>
                        <td><span class="badge bg-${post.is_published ? 'success' : 'secondary'}">${post.is_published ? 'Published' : 'Draft'}</span></td>
                        <td>${new Date(post.created_at).toLocaleDateString()}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary me-1" onclick="editBlogPost(${post.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteBlogPost(${post.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading blog posts:', error);
                showAlert('Error loading blog posts', 'error');
            }
        }

        function openBlogModal(postId = null) {
            const modal = new bootstrap.Modal(document.getElementById('blogModal'));
            const form = document.getElementById('blogForm');
            
            if (postId) {
                // Edit mode
                document.getElementById('blogModalTitle').textContent = 'Edit Blog Post';
                currentEditId = postId;
                currentEditType = 'blog';
                
                // Load post data
                fetch('/api/blog-posts').then(r => r.json()).then(posts => {
                    const post = posts.find(p => p.id === postId);
                    if (post) {
                        document.getElementById('blogId').value = post.id;
                        document.getElementById('blogTitle').value = post.title;
                        document.getElementById('blogExcerpt').value = post.excerpt || '';
                        document.getElementById('blogContent').value = post.content;
                        document.getElementById('blogPublished').checked = post.is_published;
                    }
                });
            } else {
                // Create mode
                document.getElementById('blogModalTitle').textContent = 'Create Blog Post';
                form.reset();
                currentEditId = null;
                currentEditType = null;
            }
            
            modal.show();
        }

        async function saveBlogPost(event) {
            event.preventDefault();
            
            const data = {
                title: document.getElementById('blogTitle').value,
                excerpt: document.getElementById('blogExcerpt').value,
                content: document.getElementById('blogContent').value,
                is_published: document.getElementById('blogPublished').checked
            };

            try {
                const url = currentEditId ? `/api/blog-posts/${currentEditId}` : '/api/blog-posts';
                const method = currentEditId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    bootstrap.Modal.getInstance(document.getElementById('blogModal')).hide();
                    loadBlogPosts();
                    showAlert(`Blog post ${currentEditId ? 'updated' : 'created'} successfully!`, 'success');
                } else {
                    showAlert('Error saving blog post', 'error');
                }
            } catch (error) {
                console.error('Error saving blog post:', error);
                showAlert('Error saving blog post', 'error');
            }
        }

        function editBlogPost(postId) {
            openBlogModal(postId);
        }

        async function deleteBlogPost(postId) {
            if (confirm('Are you sure you want to delete this blog post?')) {
                try {
                    const response = await fetch(`/api/blog-posts/${postId}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        loadBlogPosts();
                        showAlert('Blog post deleted successfully!', 'success');
                    } else {
                        showAlert('Error deleting blog post', 'error');
                    }
                } catch (error) {
                    console.error('Error deleting blog post:', error);
                    showAlert('Error deleting blog post', 'error');
                }
            }
        }

        // Testimonials
        async function loadTestimonials() {
            try {
                const testimonials = await fetch('/api/testimonials').then(r => r.json());
                const tbody = document.getElementById('testimonialsTableBody');
                
                tbody.innerHTML = testimonials.map(testimonial => `
                    <tr>
                        <td>${testimonial.id}</td>
                        <td>${testimonial.name}</td>
                        <td>${testimonial.role}</td>
                        <td>${'★'.repeat(testimonial.rating)}${'☆'.repeat(5-testimonial.rating)}</td>
                        <td><span class="badge bg-${testimonial.is_active ? 'success' : 'secondary'}">${testimonial.is_active ? 'Active' : 'Inactive'}</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary me-1" onclick="editTestimonial(${testimonial.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteTestimonial(${testimonial.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading testimonials:', error);
                showAlert('Error loading testimonials', 'error');
            }
        }

        function openTestimonialModal(testimonialId = null) {
            const modal = new bootstrap.Modal(document.getElementById('testimonialModal'));
            const form = document.getElementById('testimonialForm');
            
            if (testimonialId) {
                document.getElementById('testimonialModalTitle').textContent = 'Edit Testimonial';
                currentEditId = testimonialId;
                currentEditType = 'testimonial';
                
                fetch('/api/testimonials').then(r => r.json()).then(testimonials => {
                    const testimonial = testimonials.find(t => t.id === testimonialId);
                    if (testimonial) {
                        document.getElementById('testimonialId').value = testimonial.id;
                        document.getElementById('testimonialName').value = testimonial.name;
                        document.getElementById('testimonialRole').value = testimonial.role;
                        document.getElementById('testimonialCompany').value = testimonial.company || '';
                        document.getElementById('testimonialContent').value = testimonial.content;
                        document.getElementById('testimonialRating').value = testimonial.rating;
                        document.getElementById('testimonialActive').checked = testimonial.is_active;
                    }
                });
            } else {
                document.getElementById('testimonialModalTitle').textContent = 'Add Testimonial';
                form.reset();
                document.getElementById('testimonialActive').checked = true;
                currentEditId = null;
                currentEditType = null;
            }
            
            modal.show();
        }

        async function saveTestimonial(event) {
            event.preventDefault();
            
            const data = {
                name: document.getElementById('testimonialName').value,
                role: document.getElementById('testimonialRole').value,
                company: document.getElementById('testimonialCompany').value,
                content: document.getElementById('testimonialContent').value,
                rating: parseInt(document.getElementById('testimonialRating').value),
                is_active: document.getElementById('testimonialActive').checked
            };

            try {
                const url = currentEditId ? `/api/testimonials/${currentEditId}` : '/api/testimonials';
                const method = currentEditId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    bootstrap.Modal.getInstance(document.getElementById('testimonialModal')).hide();
                    loadTestimonials();
                    showAlert(`Testimonial ${currentEditId ? 'updated' : 'created'} successfully!`, 'success');
                } else {
                    showAlert('Error saving testimonial', 'error');
                }
            } catch (error) {
                console.error('Error saving testimonial:', error);
                showAlert('Error saving testimonial', 'error');
            }
        }

        function editTestimonial(testimonialId) {
            openTestimonialModal(testimonialId);
        }

        async function deleteTestimonial(testimonialId) {
            if (confirm('Are you sure you want to delete this testimonial?')) {
                try {
                    const response = await fetch(`/api/testimonials/${testimonialId}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        loadTestimonials();
                        showAlert('Testimonial deleted successfully!', 'success');
                    } else {
                        showAlert('Error deleting testimonial', 'error');
                    }
                } catch (error) {
                    console.error('Error deleting testimonial:', error);
                    showAlert('Error deleting testimonial', 'error');
                }
            }
        }

        // Team Members
        async function loadTeamMembers() {
            try {
                const members = await fetch('/api/team-members').then(r => r.json());
                const tbody = document.getElementById('teamTableBody');
                
                tbody.innerHTML = members.map(member => `
                    <tr>
                        <td>${member.id}</td>
                        <td>${member.name}</td>
                        <td>${member.position}</td>
                        <td>${member.email || 'N/A'}</td>
                        <td><span class="badge bg-${member.is_active ? 'success' : 'secondary'}">${member.is_active ? 'Active' : 'Inactive'}</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary me-1" onclick="editTeamMember(${member.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteTeamMember(${member.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading team members:', error);
                showAlert('Error loading team members', 'error');
            }
        }

        function openTeamModal(memberId = null) {
            const modal = new bootstrap.Modal(document.getElementById('teamModal'));
            const form = document.getElementById('teamForm');
            
            if (memberId) {
                document.getElementById('teamModalTitle').textContent = 'Edit Team Member';
                currentEditId = memberId;
                currentEditType = 'team';
                
                fetch('/api/team-members').then(r => r.json()).then(members => {
                    const member = members.find(m => m.id === memberId);
                    if (member) {
                        document.getElementById('teamId').value = member.id;
                        document.getElementById('teamName').value = member.name;
                        document.getElementById('teamPosition').value = member.position;
                        document.getElementById('teamBio').value = member.bio || '';
                        document.getElementById('teamEmail').value = member.email || '';
                        document.getElementById('teamActive').checked = member.is_active;
                    }
                });
            } else {
                document.getElementById('teamModalTitle').textContent = 'Add Team Member';
                form.reset();
                document.getElementById('teamActive').checked = true;
                currentEditId = null;
                currentEditType = null;
            }
            
            modal.show();
        }

        async function saveTeamMember(event) {
            event.preventDefault();
            
            const data = {
                name: document.getElementById('teamName').value,
                position: document.getElementById('teamPosition').value,
                bio: document.getElementById('teamBio').value,
                email: document.getElementById('teamEmail').value,
                is_active: document.getElementById('teamActive').checked
            };

            try {
                const url = currentEditId ? `/api/team-members/${currentEditId}` : '/api/team-members';
                const method = currentEditId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    bootstrap.Modal.getInstance(document.getElementById('teamModal')).hide();
                    loadTeamMembers();
                    showAlert(`Team member ${currentEditId ? 'updated' : 'created'} successfully!`, 'success');
                } else {
                    showAlert('Error saving team member', 'error');
                }
            } catch (error) {
                console.error('Error saving team member:', error);
                showAlert('Error saving team member', 'error');
            }
        }

        function editTeamMember(memberId) {
            openTeamModal(memberId);
        }

        async function deleteTeamMember(memberId) {
            if (confirm('Are you sure you want to delete this team member?')) {
                try {
                    const response = await fetch(`/api/team-members/${memberId}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        loadTeamMembers();
                        showAlert('Team member deleted successfully!', 'success');
                    } else {
                        showAlert('Error deleting team member', 'error');
                    }
                } catch (error) {
                    console.error('Error deleting team member:', error);
                    showAlert('Error deleting team member', 'error');
                }
            }
        }

        // Scholarships
        async function loadScholarships() {
            try {
                const scholarships = await fetch('/api/scholarships').then(r => r.json());
                const tbody = document.getElementById('scholarshipsTableBody');
                
                tbody.innerHTML = scholarships.map(scholarship => `
                    <tr>
                        <td>${scholarship.id}</td>
                        <td>${scholarship.title}</td>
                        <td>${scholarship.amount ? '$' + scholarship.amount.toLocaleString() : 'N/A'}</td>
                        <td>${scholarship.country || 'N/A'}</td>
                        <td>${scholarship.deadline ? new Date(scholarship.deadline).toLocaleDateString() : 'N/A'}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary me-1" onclick="editScholarship(${scholarship.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteScholarship(${scholarship.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading scholarships:', error);
                showAlert('Error loading scholarships', 'error');
            }
        }

        function openScholarshipModal(scholarshipId = null) {
            const modal = new bootstrap.Modal(document.getElementById('scholarshipModal'));
            const form = document.getElementById('scholarshipForm');
            
            if (scholarshipId) {
                document.getElementById('scholarshipModalTitle').textContent = 'Edit Scholarship';
                currentEditId = scholarshipId;
                currentEditType = 'scholarship';
                
                fetch('/api/scholarships').then(r => r.json()).then(scholarships => {
                    const scholarship = scholarships.find(s => s.id === scholarshipId);
                    if (scholarship) {
                        document.getElementById('scholarshipId').value = scholarship.id;
                        document.getElementById('scholarshipTitle').value = scholarship.title;
                        document.getElementById('scholarshipDescription').value = scholarship.description;
                        document.getElementById('scholarshipEligibility').value = scholarship.eligibility_criteria || '';
                        document.getElementById('scholarshipAmount').value = scholarship.amount || '';
                        document.getElementById('scholarshipCountry').value = scholarship.country || '';
                        document.getElementById('scholarshipField').value = scholarship.field_of_study || '';
                        document.getElementById('scholarshipDeadline').value = scholarship.deadline ? scholarship.deadline.split('T')[0] : '';
                        document.getElementById('scholarshipActive').checked = scholarship.is_active;
                    }
                });
            } else {
                document.getElementById('scholarshipModalTitle').textContent = 'Add Scholarship';
                form.reset();
                document.getElementById('scholarshipActive').checked = true;
                currentEditId = null;
                currentEditType = null;
            }
            
            modal.show();
        }

        async function saveScholarship(event) {
            event.preventDefault();
            
            const data = {
                title: document.getElementById('scholarshipTitle').value,
                description: document.getElementById('scholarshipDescription').value,
                eligibility_criteria: document.getElementById('scholarshipEligibility').value,
                amount: document.getElementById('scholarshipAmount').value,
                country: document.getElementById('scholarshipCountry').value,
                field_of_study: document.getElementById('scholarshipField').value,
                deadline: document.getElementById('scholarshipDeadline').value,
                is_active: document.getElementById('scholarshipActive').checked
            };

            try {
                const url = currentEditId ? `/api/scholarships/${currentEditId}` : '/api/scholarships';
                const method = currentEditId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    bootstrap.Modal.getInstance(document.getElementById('scholarshipModal')).hide();
                    loadScholarships();
                    showAlert(`Scholarship ${currentEditId ? 'updated' : 'created'} successfully!`, 'success');
                } else {
                    showAlert('Error saving scholarship', 'error');
                }
            } catch (error) {
                console.error('Error saving scholarship:', error);
                showAlert('Error saving scholarship', 'error');
            }
        }

        function editScholarship(scholarshipId) {
            openScholarshipModal(scholarshipId);
        }

        async function deleteScholarship(scholarshipId) {
            if (confirm('Are you sure you want to delete this scholarship?')) {
                try {
                    const response = await fetch(`/api/scholarships/${scholarshipId}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        loadScholarships();
                        showAlert('Scholarship deleted successfully!', 'success');
                    } else {
                        showAlert('Error deleting scholarship', 'error');
                    }
                } catch (error) {
                    console.error('Error deleting scholarship:', error);
                    showAlert('Error deleting scholarship', 'error');
                }
            }
        }

        // Applications
        async function loadApplications() {
            try {
                const applications = await fetch('/api/applications').then(r => r.json());
                const tbody = document.getElementById('applicationsTableBody');
                
                tbody.innerHTML = applications.map(application => `
                    <tr>
                        <td>${application.id}</td>
                        <td>${application.full_name}</td>
                        <td>${application.email}</td>
                        <td><span class="badge bg-warning">${application.status}</span></td>
                        <td>${new Date(application.created_at).toLocaleDateString()}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-success me-1" onclick="updateApplicationStatus(${application.id}, 'approved')">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="updateApplicationStatus(${application.id}, 'rejected')">
                                <i class="fas fa-times"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading applications:', error);
                showAlert('Error loading applications', 'error');
            }
        }

        async function updateApplicationStatus(applicationId, status) {
            const action = status === 'approved' ? 'approve' : 'reject';
            if (confirm(`Are you sure you want to ${action} this application?`)) {
                try {
                    const response = await fetch(`/api/applications/${applicationId}`, {
                        method: 'PUT',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            status: status,
                            admin_notes: `Application ${status} by admin`
                        })
                    });
                    
                    if (response.ok) {
                        loadApplications();
                        showAlert(`Application ${status} successfully!`, 'success');
                    } else {
                        showAlert('Error updating application status', 'error');
                    }
                } catch (error) {
                    console.error('Error updating application:', error);
                    showAlert('Error updating application status', 'error');
                }
            }
        }

        // Users
        async function loadUsers() {
            try {
                const users = await fetch('/api/users').then(r => r.json());
                const tbody = document.getElementById('usersTableBody');
                
                tbody.innerHTML = users.map(user => `
                    <tr>
                        <td>${user.id}</td>
                        <td>${user.email}</td>
                        <td>${user.full_name}</td>
                        <td><span class="badge bg-${user.role === 'admin' ? 'danger' : 'primary'}">${user.role}</span></td>
                        <td><span class="badge bg-${user.is_active ? 'success' : 'secondary'}">${user.is_active ? 'Active' : 'Inactive'}</span></td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading users:', error);
                showAlert('Error loading users', 'error');
            }
        }

        // Alert system
        function showAlert(message, type = 'info') {
            const alertContainer = document.getElementById('alertContainer');
            const alertId = 'alert-' + Date.now();
            
            const alertHTML = `
                <div id="${alertId}" class="alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show" role="alert">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            alertContainer.insertAdjacentHTML('beforeend', alertHTML);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                const alert = document.getElementById(alertId);
                if (alert) {
                    bootstrap.Alert.getOrCreateInstance(alert).close();
                }
            }, 5000);
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Navigation event listeners
            document.querySelectorAll('[data-section]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    showSection(section);
                });
            });

            // Load initial dashboard
            loadDashboardStats();
        });
    </script>
</body>
</html>