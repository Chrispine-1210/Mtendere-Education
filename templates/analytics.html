<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard - Mtendere Education Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/static/admin.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">
    <div class="container-fluid py-4">
        <!-- Header -->
        <div class="admin-header">
            <h1><i class="fas fa-chart-line me-2"></i>Analytics Dashboard</h1>
            <p>Comprehensive insights and metrics for Mtendere Education Consult</p>
        </div>

        <!-- Navigation -->
        <div class="admin-nav">
            <ul>
                <li><a href="/admin"><i class="fas fa-home me-1"></i>Admin Home</a></li>
                <li><a href="/analytics" class="active"><i class="fas fa-chart-line me-1"></i>Analytics</a></li>
                <li><a href="/admin/Application"><i class="fas fa-file-text me-1"></i>Applications</a></li>
                <li><a href="/admin/VisitorLog"><i class="fas fa-users me-1"></i>Visitor Logs</a></li>
            </ul>
        </div>

        <!-- Analytics Grid -->
        <div class="row">
            <!-- Visitor Analytics -->
            <div class="col-lg-6 mb-4">
                <div class="dashboard-card">
                    <h3><i class="fas fa-users text-primary me-2"></i>Visitor Analytics</h3>
                    <div class="metric">
                        <span class="metric-label">Total Visitors</span>
                        <span class="metric-value">{{ analytics.visitors.total }}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Unique Visitors</span>
                        <span class="metric-value">{{ analytics.visitors.unique }}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Return Visitors</span>
                        <span class="metric-value">{{ analytics.visitors.total - analytics.visitors.unique }}</span>
                    </div>
                </div>
            </div>

            <!-- Application Analytics -->
            <div class="col-lg-6 mb-4">
                <div class="dashboard-card">
                    <h3><i class="fas fa-file-text text-success me-2"></i>Application Analytics</h3>
                    <div class="metric">
                        <span class="metric-label">Total Applications</span>
                        <span class="metric-value">{{ analytics.applications.total }}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Pending Applications</span>
                        <span class="metric-value text-warning">{{ analytics.applications.pending }}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Approved Applications</span>
                        <span class="metric-value text-success">{{ analytics.applications.approved }}</span>
                    </div>
                </div>
            </div>

            <!-- Content Analytics -->
            <div class="col-lg-8 mb-4">
                <div class="dashboard-card">
                    <h3><i class="fas fa-newspaper text-info me-2"></i>Content Analytics</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="metric">
                                <span class="metric-label">Total Blog Posts</span>
                                <span class="metric-value">{{ analytics.content.blog_posts.total }}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Published Posts</span>
                                <span class="metric-value text-success">{{ analytics.content.blog_posts.published }}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Team Members</span>
                                <span class="metric-value">{{ analytics.content.team_members }}</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="metric">
                                <span class="metric-label">Total Testimonials</span>
                                <span class="metric-value">{{ analytics.content.testimonials.total }}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Active Testimonials</span>
                                <span class="metric-value text-success">{{ analytics.content.testimonials.active }}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Active Scholarships</span>
                                <span class="metric-value">{{ analytics.content.scholarships.active }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Application Status Chart -->
            <div class="col-lg-4 mb-4">
                <div class="dashboard-card">
                    <h3><i class="fas fa-chart-pie text-warning me-2"></i>Application Status</h3>
                    <canvas id="applicationStatusChart" width="300" height="300"></canvas>
                </div>
            </div>

            <!-- Content Overview Chart -->
            <div class="col-12 mb-4">
                <div class="dashboard-card">
                    <h3><i class="fas fa-chart-bar text-primary me-2"></i>Content Overview</h3>
                    <canvas id="contentOverviewChart" width="800" height="400"></canvas>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="col-12">
                <div class="dashboard-card">
                    <h3><i class="fas fa-bolt text-warning me-2"></i>Quick Actions</h3>
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <a href="/admin/Application" class="btn btn-admin w-100">
                                <i class="fas fa-file-text me-2"></i>Manage Applications
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="/admin/BlogPost" class="btn btn-success-admin w-100">
                                <i class="fas fa-newspaper me-2"></i>Create Blog Post
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="/admin/Testimonial" class="btn btn-warning-admin w-100">
                                <i class="fas fa-star me-2"></i>Add Testimonial
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="/admin/Scholarship" class="btn btn-danger-admin w-100">
                                <i class="fas fa-graduation-cap me-2"></i>Manage Scholarships
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Application Status Pie Chart
        const applicationStatusCtx = document.getElementById('applicationStatusChart').getContext('2d');
        new Chart(applicationStatusCtx, {
            type: 'pie',
            data: {
                labels: ['Pending', 'Approved', 'Others'],
                datasets: [{
                    data: [
                        {{ analytics.applications.pending }},
                        {{ analytics.applications.approved }},
                        {{ analytics.applications.total - analytics.applications.pending - analytics.applications.approved }}
                    ],
                    backgroundColor: [
                        '#ffc107',
                        '#28a745',
                        '#6c757d'
                    ],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Content Overview Bar Chart
        const contentOverviewCtx = document.getElementById('contentOverviewChart').getContext('2d');
        new Chart(contentOverviewCtx, {
            type: 'bar',
            data: {
                labels: ['Blog Posts', 'Published Posts', 'Team Members', 'Testimonials', 'Active Testimonials', 'Scholarships'],
                datasets: [{
                    label: 'Count',
                    data: [
                        {{ analytics.content.blog_posts.total }},
                        {{ analytics.content.blog_posts.published }},
                        {{ analytics.content.team_members }},
                        {{ analytics.content.testimonials.total }},
                        {{ analytics.content.testimonials.active }},
                        {{ analytics.content.scholarships.total }}
                    ],
                    backgroundColor: [
                        '#007bff',
                        '#28a745',
                        '#17a2b8',
                        '#ffc107',
                        '#fd7e14',
                        '#dc3545'
                    ],
                    borderColor: [
                        '#0056b3',
                        '#1e7e34',
                        '#117a8b',
                        '#e0a800',
                        '#dc6545',
                        '#bd2130'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });

        // Auto-refresh page every 5 minutes
        setTimeout(function() {
            location.reload();
        }, 300000);
    </script>
</body>
</html>
